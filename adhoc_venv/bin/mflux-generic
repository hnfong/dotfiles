#!/bin/bash
# Usage: symlink this (within the project) to match the name of the actual command installed by the python package. eg. ln -s generic_wrapper mflux-generate
set -e
pushd "$(dirname "$(readlink -f "$0")")"/.. >/dev/null
source .venv/bin/activate
popd >/dev/null

if [[ "$1" = "--type" ]]; then
    shift
    MODEL_TYPE=$1
    shift

    case "$MODEL_TYPE" in
        "flux2")
            mflux-generate-flux2 --model themindstudio/flux2-klein-9b-mlx-4bit "$@"
            ;;
        "z-image")
            mflux-generate-z-image-turbo --model filipstrand/Z-Image-Turbo-mflux-4bit "$@"
            ;;
        "krea")
            mflux-generate --model black-forest-labs/FLUX.1-Krea-dev "$@"
            ;;

        "all")
            set -x
            "$0" --type flux2 "$@"
            "$0" --type z-image "$@"
            "$0" --type krea "$@"
            "$0" "$@"  # schnell
            ;;
        *)
            echo "Unknown model type: $MODEL_TYPE"
            exit 1
            ;;
    esac
else
    PYTHONWARNINGS=ignore exec mflux-generate --model schnell "$@"
fi
